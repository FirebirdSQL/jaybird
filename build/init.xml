  <target name="init">
    <echo message="Java version: ${ant.java.version}"/>
    <echo message="Ant version: ${ant.version}"/>
    <!-- External build properties
         All properties can be overridden by adding them to build-local.properties
    -->
    <property file="${basedir}/build-local.properties" />

    <!-- Setup the build timestamp & build identifer properties -->
    <tstamp>
      <format property="build.number" pattern="yyyyMMddHHmm"/>
      <format property="YEAR" pattern="yyyy"/>
    </tstamp>
    <property name="build.id" value="${build.number}"/>

	<condition property="jdbc.40" value="true">
		<or>
            <javaversion exactly="1.6"/>
			<!-- Technically JDK 1.7 is JDBC 4.1, we use this here as an indication to use the jdbc4.0 sources -->
            <javaversion exactly="1.7"/>
		</or>
	</condition>

    <condition property="use.16.jca" value="true">
        <javaversion atleast="1.6"/>
    </condition>

    <condition property="use.16.pool" value="true">
        <javaversion atleast="1.6"/>
    </condition>

    <condition property="jdbc.42" value="true">
        <javaversion exactly="1.8"/>
    </condition>

	<!-- Java 6 specific properties -->
    <condition property="maven.jdkversion" value="jdk16">
        <javaversion exactly="1.6"/>
    </condition>

    <!-- Java 7 specific properties -->
    <condition property="maven.jdkversion" value="jdk17">
        <javaversion exactly="1.7"/>
    </condition>

      <!-- Java 8 specific properties -->
    <condition property="maven.jdkversion" value="jdk18">
        <javaversion exactly="1.8"/>
    </condition>
	
	<property name="Name" value="Jaybird"/>
    <property name="name" value="jaybird"/>

    <property name="version.major" value="2"/>
    <property name="version.minor" value="2"/>
    <property name="version.revision" value="15"/>
    <property name="version.tag.maven" value=""/>
    <property name="version.tag" value="${version.tag.maven}-"/>
    <property name="version.name" value="JDK_${ant.java.version}"/>

    <property name="version.full" value="${version.major}.${version.minor}.${version.revision}${version.tag}${version.name}"/>
    <property name="version.maven" value="${version.major}.${version.minor}.${version.revision}${version.tag.maven}"/>

    <!-- This must be set to the GitHub tag for any release -->
    <property name="version.cvstag" value="v2.2.15"/>

    <!-- Manifest version info -->
    <property name="specification.title" value="Firebird Jaybird"/>
    <property name="specification.version" value="${version.major}.${version.minor}"/>
    <property name="specification.vendor" value="FirebirdSQL (http://www.firebirdsql.org)"/>

    <property name="implementation.title" value="Jaybird"/>
    <property name="implementation.url" value="http://www.firebirdsql.org"/>
    <property name="implementation.version"
            value="${version.full} (build: tag=${version.cvstag} date=${build.id})"/>
    <property name="implementation.vendor" value="Firebird project"/>
    <property name="implementation.vendor.id" value="${implementation.url}"/>

    <!--where everything goes -->
    <property name="lib.dir" value="${basedir}/lib"/>
    <property name="lib_test.dir" value="${lib.dir}/test"/>

    <!--you will presumably need to change this if you want to use it.-->
    <!--
    <property name="jboss.base.dir" value="/usr/java/jboss/rc1/jboss-all/build/output/jboss-3.0.1RC1"/>
    <property name="jboss.deploy.dir" value="${jboss.base.dir}/server/all/deploy"/>
    -->

    <!-- Setup the module environment. -->
    <property name="module.root" value="${basedir}"/>

    <property file="${module.root}/local.properties"/>
    <property name="module.source" value="${module.root}/src"/>
    <property name="module.output" value="${module.root}/output"/>
    <property name="module.tools" value="${module.root}/lib"/>
    <property name="module.thirdparty" value="${module.source}/lib"/>
    <property name="module.etc" value="${module.source}/etc"/>
    <property name="module.examples" value="${module.root}/examples"/>

    <!-- Where source files live -->
    <property name="source.java" value="${module.source}/main"/>
    <property name="source.openoffice" value="${module.source}/openoffice"/>
    <property name="source.jdbc.40" value="${module.source}/jdbc_40"/>
    <property name="source.jdbc.42" value="${module.source}/jdbc_42"/>
    <property name="source.wire1.4" value="${module.source}/wire_jdk1_4"/>
	<property name="source.pool1.6" value="${module.source}/pool_jdk1_6"/>
	<property name="source.jca1.6" value="${module.source}/jca_jdk1_6"/>
    <property name="source.etc" value="${module.source}/etc"/>
    <property name="source.examples" value="${module.examples}"/>
    <property name="source.examples" value="${module.root}/examples"/>
    <property name="source.resources" value="${module.source}/resources"/>
    <property name="source.stylesheets" value="${module.source}/stylesheets"/>
    <property name="source.test" value="${module.source}/test"/>
    <property name="source.test.30" value="${module.source}/test_30"/>
    <property name="source.test.42" value="${module.source}/test_42"/>
    <property name="source.pool" value="${module.source}/pool"/>
    <property name="source.compatibility" value="${module.source}/compatibility"/>

    <property name="thirdparty" value="${module.root}/thirdparty"/>
    <property name="jboss.source.root" location="${thirdparty}/jboss/"/>

    <!-- Where build generated files will go -->
    <property name="build.j2ee" value="${module.output}/j2ee"/>
    <property name="build.classes" value="${module.output}/classes"/>
    <property name="build.pool" value="${module.output}/pool"/>
    <property name="build.compatibility" value="${module.output}/compatibility"/>
    <property name="build.test" value="${module.output}/test"/>
    <property name="build.lib" value="${module.output}/lib"/>
    <property name="build.api" value="${module.output}/api"/>
    <property name="build.examples" value="${module.output}/examples"/>
    <property name="build.etc" value="${module.output}/etc"/>
    <property name="build.bin" value="${module.output}/bin"/>
    <property name="build.docs" value="${module.output}/docs"/>
    <property name="build.resources" value="${module.output}/resources"/>
    <property name="build.stylesheets" value="${module.output}/stylesheets"/>
    <property name="build.reports.pure_java" value="${module.output}/reports/pure_java"/>
    <property name="build.reports.native" value="${module.output}/reports/native"/>
    <property name="build.reports.embedded" value="${module.output}/reports/embedded"/>
    <property name="build.testlog" value="${module.output}/log"/>
    <property name="build.dist" value="${module.output}/dist"/>
    <property name="build.native" value="${module.output}/native"/>
    <property name="build.native.output" value="${build.native}"/>
    <property name="build.documentation" value="${module.output}/documentation"/>
    <property name="build.maven" value="${module.output}/maven"/>

	<property name="archive.name.main" value="${name}"/>

	<property name="archive.name.rar" value="${archive.name.main}-${version.maven}.rar"/>
	<property name="archive.name.full" value="${archive.name.main}-full-${version.maven}.jar"/>
	<property name="archive.name.simple" value="${archive.name.main}-${version.maven}.jar"/>
	<property name="archive.name.test" value="${archive.name.main}-test-${version.maven}.jar"/>
	<property name="archive.name.sources" value="${archive.name.main}-${version.maven}-sources.jar"/>
	<property name="archive.name.javadoc" value="${archive.name.main}-${version.maven}-javadoc.jar"/>

    <!-- Names for maven -->
    <property name="maven.artifactId" value="${name}-${maven.jdkversion}"/>
    <property name="archive.maven.simple" value="${maven.artifactId}-${version.maven}.jar"/>
    <property name="archive.maven.sources" value="${maven.artifactId}-${version.maven}-sources.jar"/>
    <property name="archive.maven.javadoc" value="${maven.artifactId}-${version.maven}-javadoc.jar"/>
    <property name="maven.artifact.location" value="${build.maven}/${maven.artifactId}"/>
    <property name="maven.pom.template" value="${module.root}/build/maven-release/jaybird-example.pom"/>
    <property name="maven.pom.target" value="${maven.artifactId}-${version.maven}.pom"/>

    <filterset id="maven.filterSet">
      <filter token="ARTIFACT_ID" value="${maven.artifactId}"/>
      <filter token="VERSION" value="${version.maven}"/>
    </filterset>

    <!-- generate maven relocation artifact for org.firebirdsql.jdbc:jaybird -->
    <condition property="maven.generateRelocation" value="true">
      <javaversion exactly="1.7"/>
    </condition>
    <property name="maven.relocation.location" value="${build.maven}/relocation"/>
    <property name="maven.relocation.template" value="${module.root}/build/maven-release/jaybird-relocation.pom"/>
    <property name="maven.relocation.target" value="jaybird-${version.maven}.pom"/>

    <property name="junit.timeout" value="600000"/> <!-- 10 minutes -->
    <property name="junit.batchtest.todir" value="${build.reports}"/>
    <property name="junit.jvm" value="java"/>
    <property name="junit.jvm.options" value="-Ddummy"/>

    <property name="junit.formatter.type" value="xml"/>
    <property name="junit.formatter.usefile" value="true"/>
    <property name="junit.printsummary" value="true"/>
    <property name="junit.haltonerror"  value="true"/>
    <property name="junit.haltonfailure"  value="true"/>
    <property name="junit.fork" value="true"/>
    <property name="junit.timeout" value="60000"/>
    <!--property name="junit.jvm" value="true"/-->

<!-- these may be overridden on the command line to test against a server
  on another host.  For example,
./build.sh -Dtest.db.host=192.168.0.3 -Dtest.db.dir=/usr/local/firebird/dev/client-java/output/db tests-report-html
-->
    <property name="test.db.host" value="localhost"/>
    <property name="test.db.port" value="3050"/>
    <property name="test.db.dir" value="${module.output}/db"/>
    <property name="test.db.lc_ctype" value="NONE"/>

    <property name="packages" value="org.firebirdsql.ds,org.firebirdsql.gds,org.firebirdsql.jca,org.firebirdsql.jdbc,org.firebirdsql.management,org.firebirdsql.pool,org.firebirdsql.event"/>

    <property name="build.compiler" value="modern"/>

    <!-- Documentation build options -->
    <!--
        NOTE: Install pandoc from http://johnmacfarlane.net/pandoc/installing.html
        Override by use of build-local.properties in the root of the project.
    -->
    <property name="pandoc.app" location="/home/${user.name}/.cabal/bin/pandoc"/>

    <path id="javac.j2ee.classpath">
      <pathelement location="${module.thirdparty}/connector-api-1.5.jar"/>
    </path>

    <path id="javac.driver.classpath">
      <path refid="javac.j2ee.classpath"/>
      <pathelement location="${build.j2ee}"/>
      <pathelement location="${module.thirdparty}/log4j-core.jar"/>
	  <pathelement location="${module.thirdparty}/antlr-runtime-3.4.jar"/>
    </path>

    <path id="javac.pool.classpath">
      <path refid="javac.driver.classpath"/>
      <pathelement location="${build.classes}"/>
    </path>
    
    <path id="javac.compatibility.classpath">
      <path refid="javac.driver.classpath"/>
      <pathelement location="${build.classes}"/>
      <pathelement location="${build.pool}"/>
    </path>

    <path id="javac.test.classpath">
      <path refid="javac.driver.classpath"/>
      <pathelement location="${build.classes}"/>
      <pathelement location="${build.pool}"/>
      <pathelement location="${lib.dir}/junit.jar"/>
      <pathelement location="${module.thirdparty}/fscontext.jar"/>
      <pathelement location="${module.thirdparty}/providerutil.jar"/>
      <fileset dir="${lib_test.dir}" includes="*.jar"/>
    </path>

    <path id="javac.examples.classpath">
      <path refid="javac.driver.classpath"/>
      <pathelement location="${build.classes}"/>
      <pathelement location="${build.pool}"/>
    </path>

    <!--
    Determine if native code has been built and if so set 'native_library_present' property
    For amd64 it is set to jaybird22_x64 (note: detection depends on the bitness of the JVM used to run ANT!)
    -->
    <condition property="native.library.name" value="jaybird22" else="jaybird22_x64">
    	<not>
    		<os arch="amd64"/>
    	</not>
    </condition>
    <property name="native.library.location" value="${module.output}/native"/>
    <condition property="native_library_present">
    	<or>
        	<available file="${native.library.location}/${native.library.name}.dll"/>
        	<available file="${native.library.location}/lib${native.library.name}.so"/>
        </or>
    </condition>
    <condition property="no_type2_tests">
        <not><isset property="native_library_present"/></not>
    </condition>

    <!--
         Java 8 Javadoc has doclint which refuses to build Javadoc for HTML 4.01 syntax errors.
         This currently gives 100 errors and 100 warnings. We will need to clean this up eventually, but for now
         disabling seems to be the better option.
         For details see: http://blog.joda.org/2014/02/turning-off-doclint-in-jdk-8-javadoc.html
     -->
    <condition property="javadoc.additionalparam" value="-Xdoclint:none" else="">
        <javaversion exactly="1.8"/>
    </condition>

  </target>

  <!-- dumps all properties to console, both defined by init and standard ant properties -->
  <target name="showProperties" depends="init">
    <echoproperties/>
  </target>